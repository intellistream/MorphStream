<head>
  <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-eval';">
</head>
<div id="main-container">
  <nz-content id="content">
    <nz-breadcrumb>
      <nz-breadcrumb-item>Home</nz-breadcrumb-item>
      <nz-breadcrumb-item>
        <a [routerLink]="['code-editor']">Code Editor</a>
      </nz-breadcrumb-item>
    </nz-breadcrumb>
    <div id="code-container">
      <nz-row style="height: 100%; background: #F0F2F5" nzJustify="space-around">
      <nz-col nzSpan="13" style="height: 100%; background: #FFFFFF; padding: 10px 0">
        <nz-code-editor class="editor" [(ngModel)]="code" [nzEditorOption]="{ language: 'java' }"></nz-code-editor>
      </nz-col>
      <nz-col nzSpan="10" style="height: 100%; background: #FFFFFF; padding: 10px 0">
        <nz-code-editor class="editor" [(ngModel)]="description" [nzEditorOption]="{ language: 'json' }"></nz-code-editor>
      </nz-col>
      </nz-row>
    </div>
    <nz-row nzJustify="start">
      <nz-col nzSpan="24">
        <div style="text-align: right">
          <button nz-button nzSize="default" nzType="default" style="margin-right: 20px" (click)="onSubmitFiles()">Submit Via Files</button>
          <button nz-button nzSize="default" nzType="primary" style="margin-right: 20px" (click)="submitNewJob()">Submit
            New Job
          </button>
        </div>
      </nz-col>
    </nz-row>
  </nz-content>
</div>
<nz-modal
  [(nzVisible)]="isSubmittingNewJob"
  nzTitle="Configuration"
  [nzContent]="configurationContent"
  (nzOnCancel)="onCancelSubmit()"
  nzWidth="500px"
  [nzStyle]="{'top': '20%'}">
  <div *nzModalFooter>
    <button nz-button nzType="default" (click)="onCancelSubmit()">Cancel</button>
    <button nz-button nzType="primary" (click)="onConfirmSubmit()">Submit</button>
  </div>
</nz-modal>
<ng-template #configurationContent>
  <div id="modal-container">
    <form nz-form style="width: 100%" [formGroup]="submitForm">
      <nz-row>
        <nz-col nzSpan="24">
          <nz-form-item>
            <nz-form-label nzSpan="6" nzRequired>name</nz-form-label>
            <nz-form-control nzSpan="18" nzErrorTip="the job name is required!">
              <input nz-input [(ngModel)]="job" placeholder="Job" formControlName="job" style="width: 100%">
            </nz-form-control>
          </nz-form-item>
          <nz-form-item>
            <nz-form-label nzSpan="6" nzRequired>parallelism</nz-form-label>
            <nz-form-control nzSpan="18">
              <nz-input-number [(ngModel)]="parallelism" nzPlaceHolder="Parallelism" [nzMin]="1" [nzMax]="100"
                               [nzStep]="1" style="width: 100%" formControlName="parallelism"></nz-input-number>
            </nz-form-control>
          </nz-form-item>
          <nz-form-item>
            <nz-form-label nzSpan="6" nzRequired>start now</nz-form-label>
            <nz-form-control nzSpan="18">
              <nz-switch
                [ngModel]="false"
                [nzCheckedChildren]="checkedTemplate"
                [nzUnCheckedChildren]="unCheckedTemplate"
                formControlName="startNow"
              ></nz-switch>
              <ng-template #checkedTemplate><span nz-icon nzType="check"></span></ng-template>
              <ng-template #unCheckedTemplate><span nz-icon nzType="close"></span></ng-template>
            </nz-form-control>
          </nz-form-item>
        </nz-col>
      </nz-row>
    </form>
  </div>
</ng-template>

<nz-modal [(nzVisible)]="isSubmittingFiles" nzTitle="Submit Job Via Files" [nzFooter]="submitFilesFooter" (nzOnCancel)="onCancelSubmitFiles()">
  <ng-container *nzModalContent>
    <div>
      <div>
        <p>Submit <b>job definition (in Java)</b> and <b>job description (in JSON)</b> files.</p>
      </div>
      <div>
        <nz-upload
          nzListType="picture"
          [(nzFileList)]="fileList"
          nzAction="http://localhost:8080/api/signal/submit/file">
          <button nz-button nzType="text">
            <span nz-icon nzType="upload"></span>
            Upload
          </button>
        </nz-upload>
      </div>
    </div>
  </ng-container>
</nz-modal>
<ng-template #submitFilesFooter>
  <button nz-button nzType="primary" (click)="onConfirmSubmitFiles()" id="btn-submit">Submit</button>
  <button nz-button nzType="default" (click)="onCancelSubmitFiles()" id="btn-cancel">Cancel</button>
</ng-template>
